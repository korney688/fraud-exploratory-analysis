# Проект: EDA транзакций и выявление факторов мошенничества

## 1. Цель работы
Провести исследовательский анализ данных транзакций и выявить признаки и условия, которые повышают вероятность мошенничества.
Сформулировать продуктовые и технические гипотезы для бизнеса

---

## 2. Данные и особенности выборки
- Использован датасет `transaction_fraud_data.parquet` (7.5 млн строк).  
- Для ускорения работы была взята **5% выборка данных** (~370 тыс. строк) с сохранением баланса классов.  
  Была проведена оценка репрезентативности семпла выборки по сравнению средней доли мошеннических операций (доля фрода ~19,9% в подвыборке и полном датасете)
- Обработана вложенная колонка `last_hour_activity`, извлечены новые признаки:  
  `lha_num_transactions`, `lha_total_amount`, `lha_unique_merchants`, `lha_unique_countries`, `lha_max_single_amount`.

Примечание: В датасете присутствует файл historical_currency_exchange для конвертации валют. 
При анализе признака amount было выявлено, что транзакции представлены в разных валютах (что подтверждается наличием справочника historical_currency_exchange).
Это видно на графиках распределения сумм транзакций по странам и валютам: медианы и диапазоны значений сильно отличаются, например, в Йенах или Найре транзакции численно выглядят значительно больше, 
чем в USD или EUR.
В рамках текущего EDA было принято решение не приводить суммы к единой валюте, чтобы не усложнять обработку и сфокусироваться на поиске закономерностей между признаками и целевой переменной is_fraud.
Основные выявленные закономерности (страны риска ночью, web в выходные, транзакции за границей) не завязаны на абсолютные суммы и остаются корректными.
Однако пороговые значения признака amount (<10 и >10,000) являются условными и не должны интерпретироваться как реальные суммы в USD или другой валюте.
Оптимально в дальнейшем — использовать датасет historical_currency_exchange и привести суммы транзакций к единой валюте для более точной работы с признаком amount.
  
---

## 3. Как решали задачу и чем пользовались
- **Инструменты:**  
  - Python (pandas, seaborn, matplotlib, numpy)  
  - Jupyter Notebook  
- **Подход к анализу:**  
  1. EDA: распределения числовых и категориальных признаков, выявление неинформативных и аномальных признаков.  
  2. Сочетанные зависимости: тепловые карты (pivot_table + heatmap) и уточнённые графики.  
  3. Сводные таблицы для проверки цифр и финальные выводы.  
- **Принятие решений:**  
  - Сначала были рассмотрены простые распределения основных признаков (гистограммы, barplot).  
  - Затем проверены сочетания признаков (heatmap, scatter).  
  - По информативным признакам были проведены дополнительные визуализации для формулирования гипотез и рекомендаций.

---

## 4. Основные находки
1. Экстремально маленькие и большие суммы транзакций связаны с повышенной долей фрода.  
Примечание: (<10 и >10,000) в валюте страны, где была проведена транзакция (значения указаны в условных единицах датасета, так как валюты не конвертированы).
2. В странах высокого риска (Бразилия, Нигерия, Россия, Мексика) ночью (0–5 часов) доля фрода достигает 70–80%.  
3. Web-канал в выходные более подвержен мошенничеству, чем в будни.  
4. Любая транзакция за границей имеет ~57% вероятность фрода.  
5. Категория вендора малоинформативна сама по себе, но в сочетании с "за границей" или "ночью" риск выше.

---

## 5. Бизнес- и технические рекомендации
**1. Усилить проверки транзакций с экстремальными суммами**
   
**Проблема:**

Фрод часто встречается на очень маленьких (<10) и очень больших (>10,000) транзакциях.
Но нельзя уделять слишком много внимания микротранзакциям: многие пользователи действительно платят маленькие суммы.

**Решения:**

Для больших сумм:

При суммах выше установленного порога — автоматически переводить транзакцию в режим ручной проверки или двухфакторной аутентификации.
Пример: клиенту приходит push-уведомление в мобильном приложении с запросом подтвердить операцию.

Для маленьких сумм:

Считать количество мелких транзакций за короткий период (<10 за последние 30–60 минут).
Если таких транзакций больше N — выставлять высокий риск и блокировать следующие попытки до проверки.
Это можно реализовать как дополнительное правило в антимошеннической-системе: "N микротранзакций за период → тревога".

**2. Транзакции в странах высокого риска ночью**
   
**Проблема:**

В странах Бразилия, Нигерия, Россия, Мексика ночью (0–5 часов) доля фрода 70–80%.

**Решения:**
Логирование и усиленная аналитика:
Все ночные транзакции в этих странах отправлять в отдельный лог для анализа.

Повышенные требования к верификации:
Если клиент делает транзакцию ночью → включается второй фактор (например, SMS или push-код).

Динамическая блокировка:
Можно ввести "soft-block": транзакция приостанавливается до подтверждения клиентом через приложение или звонок в контакт-центр.

**3. Веб-транзакции в выходные**
   
**Проблема:**

Web-канал в выходные более уязвим. В этот период больше атак автоматических ботов и фишинга.

**Решения:**

Дополнительные проверки клиента:
Проверка устройства (fingerprint), IP-адреса (привычный ли регион/страна).
Валидация через CAPTCHA или одноразовые коды при входе на сайт в выходные дни.

Мониторинг аномалий:
Реализовать мониторинг: если в выходные с одного IP или устройства слишком много транзакций → сигнал тревоги и блокировка.

**4. Обязательная двухфакторная проверка транзакций за границей**
   
**Проблема:**

Транзакции за пределами страны клиента имеют ~57% вероятность фрода.

**Решения:**
Обязательная двухфакторная верификация:
Каждая транзакция за границей требует подтверждения в мобильном приложении или через SMS-код.

Отслеживание географии клиента:
Если геолокация телефона и место транзакции не совпадают → блокировать или замораживать до подтверждения.

Отслеживание привычной истории:
Если клиент обычно не совершает операции за границей, повышать риск транзакции.

**5. Использовать комбинации признаков для мониторинга в режиме реального времени**

**Решения:**
Реализовать гибкую систему правил систему, которая учитывает комбинации:

География + время суток (страна риска ночью).
Канал + выходные (web в выходные).
Vendor + за границей.
Частота мелких транзакций за короткий период.
Система выставляет уровень опасности транзакции(low / medium / high).

Low: пропускается без проверки.
Medium: двухфакторная верификация.
High: временная блокировка и ручная проверка.

**Технологически это можно сделать через:**
Готовые противомошеннические-системы
Внутренние скрипты в потоковой обработке: правила проверяются в реальном времени.
Интеграция с клиентскими каналами: пуши, SMS, звонки контакт-центра.



